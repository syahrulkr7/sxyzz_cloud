<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudBox - Penyimpanan Online</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Animate.css untuk animasi -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --pastel-blue: #a7d2f0;
            --pastel-green: #b5e8c3;
            --pastel-pink: #f8c8dc;
            --pastel-purple: #d9c5f4;
            --pastel-yellow: #f9e8a9;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
        }
        
        .border-outset {
            border-style: outset;
        }
        
        .file-card {
            transition: all 0.3s ease;
        }
        
        .file-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .login-container {
            animation: fadeIn 0.8s ease-out;
        }
        
        .dashboard-container {
            animation: slideIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .file-icon {
            font-size: 1.5rem;
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background-color: #e0e0e0;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        /* Kategori warna */
        .photo-category { background-color: var(--pastel-blue); }
        .video-category { background-color: var(--pastel-pink); }
        .music-category { background-color: var(--pastel-green); }
        .doc-category { background-color: var(--pastel-purple); }
        .other-category { background-color: var(--pastel-yellow); }
        
        /* Animasi untuk loading */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        /* Grid layout untuk file */
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-body {
            padding: 1.5rem;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* File preview */
        .file-preview {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        /* Compact card styles */
        .compact-card {
            padding: 1rem;
            border-radius: 10px;
        }
        
        .stats-card {
            padding: 0.75rem;
            border-radius: 8px;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Aplikasi Container -->
    <div id="app" class="min-h-screen">
        <!-- Login/Register Section -->
        <div id="auth-section" class="min-h-screen flex items-center justify-center p-4 login-container">
            <div class="w-full max-w-sm bg-white rounded-xl shadow-md overflow-hidden border-outset border-3 compact-card" style="border-color: var(--pastel-blue);">
                <div class="p-6">
                    <div class="text-center mb-6">
                        <div class="inline-flex items-center justify-center w-14 h-14 rounded-full mb-3" style="background-color: var(--pastel-blue);">
                            <i class="fas fa-cloud text-2xl text-white"></i>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-800">CloudBox</h1>
                        <p class="text-sm text-gray-600 mt-1">Penyimpanan online kompak</p>
                    </div>
                    
                    <div id="login-form">
                        <h2 class="text-xl font-bold text-center mb-4 text-gray-800">Masuk ke Akun</h2>
                        <div class="mb-4 p-3 rounded-lg bg-blue-50 border-l-3 border-blue-500">
                            <p class="text-xs text-blue-800">
                                <i class="fas fa-info-circle mr-1"></i>
                                Sistem mendeteksi IP Anda untuk login otomatis.
                            </p>
                        </div>
                        
                        <div class="mb-4">
                            <label for="username" class="block text-sm text-gray-700 mb-1">Nama Pengguna</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-user text-gray-400 text-sm"></i>
                                </div>
                                <input type="text" id="username" class="w-full pl-9 pr-3 py-2 text-sm rounded-lg border-2 border-gray-300 focus:border-blue-500 focus:outline-none transition-colors" placeholder="Masukkan username">
                            </div>
                            <p id="username-error" class="text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                        
                        <button id="login-btn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-medium py-2 rounded-lg hover:opacity-90 transition-opacity mb-3 flex items-center justify-center text-sm">
                            <span id="login-text">
                                <i class="fas fa-sign-in-alt mr-1"></i>Masuk atau Daftar
                            </span>
                            <span id="login-spinner" class="hidden">
                                <i class="fas fa-circle-notch spinner mr-1"></i>Memproses...
                            </span>
                        </button>
                        
                        <div class="text-center text-xs text-gray-600">
                            <p>Dengan masuk, Anda menyetujui <a href="#" class="text-blue-600 hover:underline">Ketentuan Layanan</a>.</p>
                        </div>
                    </div>
                    
                    <div id="ip-info" class="mt-4 p-3 rounded-lg text-xs" style="background-color: var(--pastel-green);">
                        <div class="flex items-center">
                            <i class="fas fa-network-wired mr-2 text-sm"></i>
                            <div>
                                <p class="font-medium">IP Anda: <span id="ip-address" class="font-bold">Mendeteksi...</span></p>
                                <p class="text-xs mt-0.5">Untuk login otomatis di masa depan.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Section (Awalnya tersembunyi) -->
        <div id="dashboard-section" class="hidden min-h-screen dashboard-container">
            <!-- Header Compact -->
            <header class="bg-white shadow-sm border-outset border-b-3" style="border-color: var(--pastel-purple);">
                <div class="container mx-auto px-3 py-3">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="flex items-center mb-2 md:mb-0">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center mr-2" style="background-color: var(--pastel-purple);">
                                <i class="fas fa-cloud text-white text-sm"></i>
                            </div>
                            <div>
                                <h1 class="text-lg font-bold text-gray-800">CloudBox</h1>
                                <p class="text-xs text-gray-600">Penyimpanan kompak & cepat</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-3">
                            <div class="hidden md:block text-right">
                                <p class="font-medium text-gray-800 text-sm" id="welcome-user">Selamat datang!</p>
                                <p class="text-xs text-gray-600">IP: <span id="user-ip"></span></p>
                            </div>
                            <div class="relative">
                                <button id="user-menu-btn" class="w-8 h-8 rounded-full overflow-hidden border-2 flex items-center justify-center" style="border-color: var(--pastel-blue); background-color: var(--pastel-blue);">
                                    <i class="fas fa-user text-white text-sm"></i>
                                </button>
                                <div id="user-menu" class="hidden absolute right-0 mt-1 w-40 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-10">
                                    <div class="px-3 py-1 border-b">
                                        <p class="font-medium text-gray-800 text-sm" id="menu-username"></p>
                                        <p class="text-xs text-gray-600" id="menu-ip"></p>
                                    </div>
                                    <button id="logout-btn" class="w-full text-left px-3 py-1.5 text-gray-700 hover:bg-gray-100 text-sm">
                                        <i class="fas fa-sign-out-alt mr-1"></i>Keluar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Main Content Compact -->
            <main class="container mx-auto px-3 py-5">
                <!-- Stats Cards Compact -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-5">
                    <div class="bg-white rounded-lg p-3 shadow-sm border-outset border-2 stats-card photo-category">
                        <div class="flex items-center">
                            <div class="w-9 h-9 rounded-full flex items-center justify-center mr-2" style="background-color: rgba(255,255,255,0.7);">
                                <i class="fas fa-camera text-sm" style="color: #3b82f6;"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold" id="stats-photo">0</h3>
                                <p class="text-xs text-gray-600">Foto</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-3 shadow-sm border-outset border-2 stats-card video-category">
                        <div class="flex items-center">
                            <div class="w-9 h-9 rounded-full flex items-center justify-center mr-2" style="background-color: rgba(255,255,255,0.7);">
                                <i class="fas fa-video text-sm" style="color: #ec4899;"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold" id="stats-video">0</h3>
                                <p class="text-xs text-gray-600">Video</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-3 shadow-sm border-outset border-2 stats-card music-category">
                        <div class="flex items-center">
                            <div class="w-9 h-9 rounded-full flex items-center justify-center mr-2" style="background-color: rgba(255,255,255,0.7);">
                                <i class="fas fa-music text-sm" style="color: #10b981;"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold" id="stats-music">0</h3>
                                <p class="text-xs text-gray-600">Musik</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-3 shadow-sm border-outset border-2 stats-card doc-category">
                        <div class="flex items-center">
                            <div class="w-9 h-9 rounded-full flex items-center justify-center mr-2" style="background-color: rgba(255,255,255,0.7);">
                                <i class="fas fa-file text-sm" style="color: #8b5cf6;"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold" id="stats-doc">0</h3>
                                <p class="text-xs text-gray-600">Dokumen</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Storage Usage Compact -->
                <div class="bg-white rounded-lg shadow-sm p-4 mb-5 border-outset border-2 compact-card" style="border-color: var(--pastel-yellow);">
                    <h2 class="text-sm font-bold mb-3 flex items-center">
                        <i class="fas fa-hdd mr-1 text-xs"></i> Penyimpanan
                    </h2>
                    <div class="mb-1 flex justify-between">
                        <span class="text-gray-700 text-xs" id="storage-text">0 GB dari 10 GB</span>
                        <span class="font-bold text-xs" id="storage-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill bg-gradient-to-r from-green-400 to-blue-500" style="width: 0%;"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mt-1">
                        <span>0 GB</span>
                        <span id="storage-limit">10 GB</span>
                    </div>
                </div>
                
                <!-- Upload File Compact -->
                <div class="bg-white rounded-lg shadow-sm p-4 mb-5 border-outset border-2 compact-card" style="border-color: var(--pastel-green);">
                    <h2 class="text-sm font-bold mb-3 flex items-center">
                        <i class="fas fa-cloud-upload-alt mr-1 text-xs"></i> Unggah File
                    </h2>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors" id="drop-area">
                        <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                        <p class="text-gray-600 text-xs mb-1">Seret dan lepas file di sini</p>
                        <p class="text-xs text-gray-500 mb-2">Maksimum: 100MB</p>
                        <input type="file" id="file-input" class="hidden" multiple>
                        <button id="browse-btn" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white font-medium py-1.5 px-4 rounded-lg hover:opacity-90 transition-opacity text-xs">
                            <i class="fas fa-folder-open mr-1"></i>Pilih File
                        </button>
                    </div>
                    <div id="file-list" class="mt-3 space-y-1.5"></div>
                </div>
                
                <!-- File Grid View -->
                <div class="mb-5">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-sm font-bold flex items-center">
                            <i class="fas fa-folder-open mr-1 text-xs"></i> File Saya
                        </h2>
                        <div class="flex space-x-1">
                            <button id="view-grid" class="p-1.5 rounded bg-gray-100 text-gray-700 hover:bg-gray-200">
                                <i class="fas fa-th-large text-xs"></i>
                            </button>
                            <button id="view-list" class="p-1.5 rounded bg-blue-100 text-blue-600">
                                <i class="fas fa-list text-xs"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Grid View -->
                    <div id="files-grid-view" class="files-grid">
                        <!-- File cards akan ditambahkan di sini secara dinamis -->
                        <div class="text-center py-8 text-gray-500 col-span-full">
                            <i class="fas fa-folder-open text-2xl mb-2"></i>
                            <p class="text-sm">Belum ada file. Unggah file pertama Anda!</p>
                        </div>
                    </div>
                    
                    <!-- List View (Awalnya tersembunyi) -->
                    <div id="files-list-view" class="hidden">
                        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="py-2 px-3 text-left">Nama File</th>
                                        <th class="py-2 px-3 text-left">Jenis</th>
                                        <th class="py-2 px-3 text-left">Ukuran</th>
                                        <th class="py-2 px-3 text-left">Tanggal</th>
                                        <th class="py-2 px-3 text-left">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-files">
                                    <tr>
                                        <td colspan="5" class="py-6 text-center text-gray-500">
                                            <i class="fas fa-folder-open text-lg mb-1"></i>
                                            <p class="text-xs">Belum ada file.</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer Compact -->
            <footer class="mt-6 py-4 text-center text-gray-600 border-t border-gray-200 text-xs">
                <div class="container mx-auto px-3">
                    <p>Â© 2023 CloudBox. Semua hak dilindungi.</p>
                    <p class="mt-1">Dibuat dengan <i class="fas fa-heart text-red-500"></i> untuk penyimpanan online</p>
                </div>
            </footer>
        </div>
        
        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-5 py-2 rounded-lg shadow-lg transform translate-y-full opacity-0 transition-all duration-300 z-50 max-w-sm">
            <div class="flex items-center">
                <i id="toast-icon" class="fas fa-info-circle mr-2 text-sm"></i>
                <p id="toast-message" class="text-sm"></p>
            </div>
        </div>
        
        <!-- Modal Preview File -->
        <div id="preview-modal" class="modal">
            <div class="modal-content w-full md:w-1/2">
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 class="font-bold text-lg" id="preview-title">Preview File</h3>
                    <button id="close-preview" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="preview-content" class="text-center">
                        <!-- Konten preview akan dimuat di sini -->
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="flex justify-between mb-2">
                            <span class="font-medium">Nama File:</span>
                            <span id="preview-filename" class="text-gray-700"></span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="font-medium">Jenis:</span>
                            <span id="preview-type" class="text-gray-700"></span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="font-medium">Ukuran:</span>
                            <span id="preview-size" class="text-gray-700"></span>
                        </div>
                        <div class="flex justify-between mb-4">
                            <span class="font-medium">Tanggal:</span>
                            <span id="preview-date" class="text-gray-700"></span>
                        </div>
                        <div class="flex justify-center space-x-3">
                            <button id="preview-download" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center">
                                <i class="fas fa-download mr-2"></i>Unduh
                            </button>
                            <button id="preview-share" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center">
                                <i class="fas fa-share-alt mr-2"></i>Bagikan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal Bagikan File -->
        <div id="share-modal" class="modal">
            <div class="modal-content w-full md:w-1/3">
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 class="font-bold text-lg">Bagikan File</h3>
                    <button id="close-share" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Nama File:</label>
                        <p id="share-filename" class="font-medium text-gray-800"></p>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Link Berbagi:</label>
                        <div class="flex">
                            <input type="text" id="share-link" class="flex-grow border border-gray-300 rounded-l-lg p-2 text-sm" readonly>
                            <button id="copy-link" class="bg-blue-500 text-white px-3 rounded-r-lg hover:bg-blue-600">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Berbagi ke:</label>
                        <div class="flex space-x-2">
                            <button class="share-social bg-blue-600 text-white p-2 rounded-lg hover:opacity-90">
                                <i class="fab fa-facebook-f"></i>
                            </button>
                            <button class="share-social bg-blue-400 text-white p-2 rounded-lg hover:opacity-90">
                                <i class="fab fa-twitter"></i>
                            </button>
                            <button class="share-social bg-red-500 text-white p-2 rounded-lg hover:opacity-90">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                            <button class="share-social bg-gray-800 text-white p-2 rounded-lg hover:opacity-90">
                                <i class="fas fa-envelope"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-2">Atur Akses:</label>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <input type="radio" id="access-public" name="access" checked class="mr-2">
                                <label for="access-public" class="text-sm">Publik (siapa saja dengan link)</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" id="access-private" name="access" class="mr-2">
                                <label for="access-private" class="text-sm">Pribadi (hanya Anda)</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // KONFIGURASI APLIKASI
        // ============================
        const APP_NAME = 'CloudBox';
        const STORAGE_KEY = 'cloudbox_users';
        const CURRENT_USER_KEY = 'cloudbox_current_user';
        const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB
        
        // ============================
        // API untuk mendapatkan IP (dengan fallback)
        // ============================
        const IP_API_URLS = [
            'https://api.ipify.org?format=json',
            'https://api64.ipify.org?format=json',
            'https://ipinfo.io/json'
        ];
        
        // ============================
        // KELAS UTILITAS
        // ============================
        class Toast {
            static show(message, type = 'info') {
                const toast = document.getElementById('toast');
                const toastIcon = document.getElementById('toast-icon');
                const toastMessage = document.getElementById('toast-message');
                
                // Set ikon berdasarkan tipe
                let iconClass = 'fa-info-circle';
                let bgColor = 'bg-gray-800';
                
                switch(type) {
                    case 'success':
                        iconClass = 'fa-check-circle';
                        bgColor = 'bg-green-600';
                        break;
                    case 'error':
                        iconClass = 'fa-exclamation-circle';
                        bgColor = 'bg-red-600';
                        break;
                    case 'warning':
                        iconClass = 'fa-exclamation-triangle';
                        bgColor = 'bg-yellow-600';
                        break;
                }
                
                // Update toast
                toastIcon.className = `fas ${iconClass} mr-2 text-sm`;
                toast.className = `fixed bottom-4 right-4 ${bgColor} text-white px-5 py-2 rounded-lg shadow-lg transform translate-y-full opacity-0 transition-all duration-300 z-50 max-w-sm`;
                toastMessage.textContent = message;
                
                // Tampilkan toast
                setTimeout(() => {
                    toast.classList.remove('translate-y-full', 'opacity-0');
                    toast.classList.add('translate-y-0', 'opacity-100');
                }, 10);
                
                // Sembunyikan toast setelah 3 detik
                setTimeout(() => {
                    toast.classList.remove('translate-y-0', 'opacity-100');
                    toast.classList.add('translate-y-full', 'opacity-0');
                }, 3000);
            }
        }
        
        class FileManager {
            static formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            static getFileIcon(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                
                if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {
                    return 'fa-image';
                } else if (['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv', 'webm'].includes(ext)) {
                    return 'fa-video';
                } else if (['mp3', 'wav', 'flac', 'aac', 'ogg', 'm4a'].includes(ext)) {
                    return 'fa-music';
                } else if (['pdf'].includes(ext)) {
                    return 'fa-file-pdf';
                } else if (['doc', 'docx'].includes(ext)) {
                    return 'fa-file-word';
                } else if (['xls', 'xlsx'].includes(ext)) {
                    return 'fa-file-excel';
                } else if (['ppt', 'pptx'].includes(ext)) {
                    return 'fa-file-powerpoint';
                } else if (['txt', 'rtf'].includes(ext)) {
                    return 'fa-file-alt';
                } else if (['zip', 'rar', '7z'].includes(ext)) {
                    return 'fa-file-archive';
                } else {
                    return 'fa-file';
                }
            }
            
            static getFileType(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                
                if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {
                    return 'Foto';
                } else if (['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv', 'webm'].includes(ext)) {
                    return 'Video';
                } else if (['mp3', 'wav', 'flac', 'aac', 'ogg', 'm4a'].includes(ext)) {
                    return 'Musik';
                } else if (['pdf', 'doc', 'docx', 'txt', 'xls', 'xlsx', 'ppt', 'pptx', 'rtf'].includes(ext)) {
                    return 'Dokumen';
                } else if (['zip', 'rar', '7z'].includes(ext)) {
                    return 'Arsip';
                } else {
                    return 'Lainnya';
                }
            }
            
            static getFileTypeColor(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                
                if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {
                    return 'photo-category';
                } else if (['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv', 'webm'].includes(ext)) {
                    return 'video-category';
                } else if (['mp3', 'wav', 'flac', 'aac', 'ogg', 'm4a'].includes(ext)) {
                    return 'music-category';
                } else if (['pdf', 'doc', 'docx', 'txt', 'xls', 'xlsx', 'ppt', 'pptx', 'rtf'].includes(ext)) {
                    return 'doc-category';
                } else {
                    return 'other-category';
                }
            }
            
            static generatePreview(file, fileData) {
                const ext = fileData.name.split('.').pop().toLowerCase();
                const size = this.formatFileSize(fileData.size);
                const date = new Date(fileData.uploadedAt).toLocaleDateString('id-ID');
                
                let previewHTML = '';
                
                if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {
                    // Preview gambar
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('preview-content').innerHTML = `
                            <img src="${e.target.result}" alt="${fileData.name}" class="file-preview">
                        `;
                    };
                    reader.readAsDataURL(file);
                    previewHTML = `<p class="text-gray-600">Membuat preview gambar...</p>`;
                } 
                else if (['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv', 'webm'].includes(ext)) {
                    // Preview video
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('preview-content').innerHTML = `
                            <video controls class="file-preview">
                                <source src="${e.target.result}" type="video/${ext === 'mp4' ? 'mp4' : ext === 'webm' ? 'webm' : 'ogg'}">
                                Browser Anda tidak mendukung tag video.
                            </video>
                        `;
                    };
                    reader.readAsDataURL(file);
                    previewHTML = `<p class="text-gray-600">Membuat preview video...</p>`;
                }
                else if (['mp3', 'wav', 'flac', 'aac', 'ogg', 'm4a'].includes(ext)) {
                    // Preview audio
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('preview-content').innerHTML = `
                            <audio controls class="w-full my-4">
                                <source src="${e.target.result}" type="audio/${ext === 'mp3' ? 'mpeg' : ext === 'ogg' ? 'ogg' : 'wav'}">
                                Browser Anda tidak mendukung tag audio.
                            </audio>
                        `;
                    };
                    reader.readAsDataURL(file);
                    previewHTML = `<p class="text-gray-600">Membuat preview audio...</p>`;
                }
                else if (ext === 'pdf') {
                    previewHTML = `
                        <div class="p-4 bg-gray-100 rounded-lg">
                            <i class="fas fa-file-pdf text-5xl text-red-500 mb-3"></i>
                            <p class="text-gray-700">File PDF: ${fileData.name}</p>
                            <p class="text-sm text-gray-600 mt-2">Gunakan aplikasi PDF viewer untuk membuka file ini.</p>
                        </div>
                    `;
                }
                else {
                    previewHTML = `
                        <div class="p-4 bg-gray-100 rounded-lg">
                            <i class="fas ${this.getFileIcon(fileData.name)} text-5xl text-gray-500 mb-3"></i>
                            <p class="text-gray-700">${fileData.name}</p>
                            <p class="text-sm text-gray-600 mt-2">File ${ext.toUpperCase()}. Tidak ada preview yang tersedia.</p>
                        </div>
                    `;
                }
                
                // Update info file
                document.getElementById('preview-filename').textContent = fileData.name;
                document.getElementById('preview-type').textContent = this.getFileType(fileData.name);
                document.getElementById('preview-size').textContent = size;
                document.getElementById('preview-date').textContent = date;
                
                return previewHTML;
            }
        }
        
        // ============================
        // KELAS APLIKASI UTAMA
        // ============================
        class CloudBoxApp {
            constructor() {
                this.currentUser = null;
                this.userIP = null;
                this.users = this.loadUsers();
                this.isInitializing = true;
                this.currentView = 'grid'; // 'grid' atau 'list'
                this.currentPreviewFile = null;
                this.currentShareFile = null;
                
                // Inisialisasi app
                this.initializeApp();
            }
            
            // Muat data pengguna dari localStorage
            loadUsers() {
                try {
                    const usersJson = localStorage.getItem(STORAGE_KEY);
                    return usersJson ? JSON.parse(usersJson) : {};
                } catch (error) {
                    console.error('Error loading users:', error);
                    return {};
                }
            }
            
            // Simpan data pengguna ke localStorage
            saveUsers() {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(this.users));
                } catch (error) {
                    console.error('Error saving users:', error);
                }
            }
            
            // Dapatkan alamat IP pengguna dengan multiple fallback
            async getUserIP() {
                // Coba beberapa API
                for (const apiUrl of IP_API_URLS) {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 3000);
                        
                        const response = await fetch(apiUrl, { 
                            signal: controller.signal 
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) continue;
                        
                        const data = await response.json();
                        if (apiUrl.includes('ipinfo')) {
                            return data.ip;
                        } else {
                            return data.ip || data;
                        }
                    } catch (error) {
                        console.log(`API ${apiUrl} failed, trying next...`);
                        continue;
                    }
                }
                
                // Jika semua API gagal, gunakan IP fallback untuk demo
                console.log('All IP APIs failed, using fallback IP');
                return `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
            }
            
            // Validasi username
            validateUsername(username) {
                if (!username || username.trim() === '') {
                    return { valid: false, message: 'Username tidak boleh kosong' };
                }
                
                if (username.length < 3) {
                    return { valid: false, message: 'Username minimal 3 karakter' };
                }
                
                if (username.length > 20) {
                    return { valid: false, message: 'Username maksimal 20 karakter' };
                }
                
                if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                    return { valid: false, message: 'Username hanya boleh berisi huruf, angka, dan underscore' };
                }
                
                return { valid: true, message: '' };
            }
            
            // Login atau daftar pengguna
            loginOrRegister(username, ip) {
                const validation = this.validateUsername(username);
                if (!validation.valid) {
                    Toast.show(validation.message, 'error');
                    return false;
                }
                
                // Bersihkan username
                username = username.trim();
                
                // Cek apakah pengguna sudah ada dengan IP yang sama
                const userKey = `${username}_${ip}`;
                
                if (this.users[userKey]) {
                    // Login pengguna yang sudah ada
                    this.currentUser = { username, ip, ...this.users[userKey] };
                    Toast.show(`Selamat datang kembali, ${username}!`, 'success');
                } else {
                    // Buat pengguna baru
                    const newUser = {
                        username,
                        ip,
                        createdAt: new Date().toISOString(),
                        files: [],
                        storageUsed: 0,
                        storageLimit: 10 * 1024 * 1024 * 1024 // 10GB
                    };
                    
                    this.users[userKey] = newUser;
                    this.currentUser = newUser;
                    this.saveUsers();
                    
                    Toast.show(`Akun baru berhasil dibuat untuk ${username}!`, 'success');
                }
                
                // Simpan pengguna saat ini
                localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(this.currentUser));
                
                return true;
            }
            
            // Logout pengguna
            logout() {
                this.currentUser = null;
                localStorage.removeItem(CURRENT_USER_KEY);
                Toast.show('Anda telah keluar', 'info');
                this.showLogin();
            }
            
            // Cek apakah ada pengguna yang sudah login
            checkAutoLogin() {
                try {
                    const savedUser = localStorage.getItem(CURRENT_USER_KEY);
                    
                    if (savedUser) {
                        const user = JSON.parse(savedUser);
                        const userKey = `${user.username}_${user.ip}`;
                        
                        // Verifikasi bahwa pengguna masih ada di database
                        if (this.users[userKey]) {
                            // Update dengan data terbaru dari database
                            this.currentUser = { ...user, ...this.users[userKey] };
                            return true;
                        } else {
                            // Hapus data login jika user tidak ditemukan
                            localStorage.removeItem(CURRENT_USER_KEY);
                        }
                    }
                } catch (error) {
                    console.error('Error checking auto-login:', error);
                    localStorage.removeItem(CURRENT_USER_KEY);
                }
                
                return false;
            }
            
            // Tambahkan file ke pengguna
            addFile(file) {
                if (!this.currentUser) return false;
                
                const userKey = `${this.currentUser.username}_${this.currentUser.ip}`;
                
                // Cek ukuran file
                if (file.size > MAX_FILE_SIZE) {
                    Toast.show(`File ${file.name} terlalu besar (maksimal ${FileManager.formatFileSize(MAX_FILE_SIZE)})`, 'error');
                    return false;
                }
                
                // Cek apakah penyimpanan cukup
                if (this.currentUser.storageUsed + file.size > this.currentUser.storageLimit) {
                    Toast.show('Penyimpanan tidak cukup', 'error');
                    return false;
                }
                
                // Tambahkan file
                const fileData = {
                    id: Date.now().toString(),
                    name: file.name,
                    size: file.size,
                    type: FileManager.getFileType(file.name),
                    uploadedAt: new Date().toISOString(),
                    fileObject: file // Simpan objek file untuk preview
                };
                
                this.users[userKey].files.push(fileData);
                this.users[userKey].storageUsed += file.size;
                this.currentUser = this.users[userKey];
                
                // Simpan perubahan
                this.saveUsers();
                localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(this.currentUser));
                
                Toast.show(`File ${file.name} berhasil diunggah`, 'success');
                return true;
            }
            
            // Inisialisasi aplikasi
            async initializeApp() {
                try {
                    // Tampilkan status deteksi IP
                    document.getElementById('ip-address').textContent = 'Mendeteksi...';
                    
                    // Dapatkan IP pengguna
                    this.userIP = await this.getUserIP();
                    
                    // Update tampilan IP
                    const ipElement = document.getElementById('ip-address');
                    if (ipElement) {
                        ipElement.textContent = this.userIP;
                        ipElement.classList.remove('text-gray-500');
                        ipElement.classList.add('text-green-600');
                    }
                    
                    // Cek auto-login
                    const isAutoLoggedIn = this.checkAutoLogin();
                    
                    if (isAutoLoggedIn) {
                        // Beri sedikit delay untuk animasi
                        setTimeout(() => {
                            this.showDashboard();
                        }, 500);
                    } else {
                        this.showLogin();
                    }
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    // Tampilkan pesan selamat datang
                    setTimeout(() => {
                        Toast.show(`Selamat datang di ${APP_NAME}!`, 'info');
                    }, 1000);
                    
                } catch (error) {
                    console.error('Error initializing app:', error);
                    Toast.show('Terjadi kesalahan saat menginisialisasi aplikasi', 'error');
                    
                    // Fallback ke mode login
                    this.userIP = 'Tidak terdeteksi';
                    document.getElementById('ip-address').textContent = this.userIP;
                    this.showLogin();
                } finally {
                    this.isInitializing = false;
                }
            }
            
            // Tampilkan halaman login
            showLogin() {
                document.getElementById('auth-section').classList.remove('hidden');
                document.getElementById('dashboard-section').classList.add('hidden');
                
                // Reset form
                document.getElementById('username').value = '';
                document.getElementById('username-error').classList.add('hidden');
                
                // Tampilkan IP jika sudah didapatkan
                if (this.userIP) {
                    document.getElementById('ip-address').textContent = this.userIP;
                }
            }
            
            // Tampilkan dashboard
            showDashboard() {
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('dashboard-section').classList.remove('hidden');
                
                // Update info pengguna
                if (this.currentUser) {
                    document.getElementById('welcome-user').textContent = `Selamat datang, ${this.currentUser.username}!`;
                    document.getElementById('user-ip').textContent = this.currentUser.ip;
                    document.getElementById('menu-username').textContent = this.currentUser.username;
                    document.getElementById('menu-ip').textContent = `IP: ${this.currentUser.ip}`;
                    
                    // Update penggunaan penyimpanan
                    this.updateStorageInfo();
                    
                    // Update statistik file
                    this.updateFileStats();
                    
                    // Tampilkan file
                    this.displayFiles();
                }
            }
            
            // Update informasi penyimpanan
            updateStorageInfo() {
                if (!this.currentUser) return;
                
                const usedGB = (this.currentUser.storageUsed / (1024 * 1024 * 1024)).toFixed(1);
                const totalGB = (this.currentUser.storageLimit / (1024 * 1024 * 1024)).toFixed(0);
                const usagePercent = ((this.currentUser.storageUsed / this.currentUser.storageLimit) * 100).toFixed(1);
                
                document.getElementById('storage-text').textContent = `${usedGB} GB dari ${totalGB} GB`;
                document.getElementById('storage-percent').textContent = `${usagePercent}%`;
                document.getElementById('storage-limit').textContent = `${totalGB} GB`;
                document.getElementById('progress-fill').style.width = `${usagePercent}%`;
            }
            
            // Update statistik file
            updateFileStats() {
                const stats = this.calculateFileStats();
                
                document.getElementById('stats-photo').textContent = stats.photo;
                document.getElementById('stats-video').textContent = stats.video;
                document.getElementById('stats-music').textContent = stats.music;
                document.getElementById('stats-doc').textContent = stats.doc;
            }
            
            // Hitung statistik file
            calculateFileStats() {
                const stats = { 
                    photo: 0, 
                    video: 0, 
                    music: 0, 
                    doc: 0, 
                    other: 0
                };
                
                if (this.currentUser && this.currentUser.files) {
                    this.currentUser.files.forEach(file => {
                        if (file.type === 'Foto') stats.photo++;
                        else if (file.type === 'Video') stats.video++;
                        else if (file.type === 'Musik') stats.music++;
                        else if (file.type === 'Dokumen') stats.doc++;
                        else stats.other++;
                    });
                }
                
                return stats;
            }
            
            // Tampilkan file dalam grid
            displayFiles() {
                const gridView = document.getElementById('files-grid-view');
                const listView = document.getElementById('files-list-view');
                
                if (!this.currentUser || !this.currentUser.files || this.currentUser.files.length === 0) {
                    gridView.innerHTML = `
                        <div class="text-center py-8 text-gray-500 col-span-full">
                            <i class="fas fa-folder-open text-2xl mb-2"></i>
                            <p class="text-sm">Belum ada file. Unggah file pertama Anda!</p>
                        </div>
                    `;
                    
                    document.getElementById('recent-files').innerHTML = `
                        <tr>
                            <td colspan="5" class="py-6 text-center text-gray-500">
                                <i class="fas fa-folder-open text-lg mb-1"></i>
                                <p class="text-xs">Belum ada file.</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Urutkan file berdasarkan tanggal upload (terbaru pertama)
                const sortedFiles = [...this.currentUser.files].sort((a, b) => 
                    new Date(b.uploadedAt) - new Date(a.uploadedAt)
                );
                
                // Tampilkan dalam grid view
                let gridHTML = '';
                sortedFiles.forEach(file => {
                    const icon = FileManager.getFileIcon(file.name);
                    const size = FileManager.formatFileSize(file.size);
                    const date = new Date(file.uploadedAt).toLocaleDateString('id-ID');
                    const typeColor = FileManager.getFileTypeColor(file.name);
                    
                    gridHTML += `
                        <div class="file-card bg-white rounded-lg shadow-sm overflow-hidden border-outset border-2 ${typeColor} compact-card">
                            <div class="p-3">
                                <div class="flex items-center mb-2">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-2" style="background-color: rgba(255,255,255,0.7);">
                                        <i class="fas ${icon} text-sm"></i>
                                    </div>
                                    <div class="flex-grow">
                                        <h4 class="font-medium text-xs truncate" title="${file.name}">${file.name}</h4>
                                        <p class="text-xs text-gray-600">${size}</p>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center text-xs text-gray-600 mb-2">
                                    <span>${file.type}</span>
                                    <span>${date}</span>
                                </div>
                                <div class="flex justify-between">
                                    <button class="preview-btn text-blue-600 hover:text-blue-800 p-1" data-file-id="${file.id}">
                                        <i class="fas fa-eye text-xs"></i>
                                    </button>
                                    <button class="download-btn text-green-600 hover:text-green-800 p-1" data-file-id="${file.id}">
                                        <i class="fas fa-download text-xs"></i>
                                    </button>
                                    <button class="share-btn text-purple-600 hover:text-purple-800 p-1" data-file-id="${file.id}">
                                        <i class="fas fa-share-alt text-xs"></i>
                                    </button>
                                    <button class="delete-btn text-red-600 hover:text-red-800 p-1" data-file-id="${file.id}">
                                        <i class="fas fa-trash text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                gridView.innerHTML = gridHTML;
                
                // Tampilkan dalam list view
                let listHTML = '';
                sortedFiles.slice(0, 10).forEach(file => {
                    const icon = FileManager.getFileIcon(file.name);
                    const size = FileManager.formatFileSize(file.size);
                    const date = new Date(file.uploadedAt).toLocaleDateString('id-ID');
                    
                    listHTML += `
                        <tr class="border-t border-gray-100 hover:bg-gray-50">
                            <td class="py-2 px-3">
                                <div class="flex items-center">
                                    <i class="fas ${icon} mr-2 text-blue-500 text-xs"></i>
                                    <span class="font-medium truncate max-w-xs text-xs">${file.name}</span>
                                </div>
                            </td>
                            <td class="py-2 px-3 text-xs">${file.type}</td>
                            <td class="py-2 px-3 text-xs">${size}</td>
                            <td class="py-2 px-3 text-xs">${date}</td>
                            <td class="py-2 px-3">
                                <button class="preview-btn text-blue-600 hover:text-blue-800 p-1" data-file-id="${file.id}">
                                    <i class="fas fa-eye text-xs"></i>
                                </button>
                                <button class="download-btn text-green-600 hover:text-green-800 p-1 mr-1" data-file-id="${file.id}">
                                    <i class="fas fa-download text-xs"></i>
                                </button>
                                <button class="share-btn text-purple-600 hover:text-purple-800 p-1 mr-1" data-file-id="${file.id}">
                                    <i class="fas fa-share-alt text-xs"></i>
                                </button>
                                <button class="delete-btn text-red-600 hover:text-red-800 p-1" data-file-id="${file.id}">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                document.getElementById('recent-files').innerHTML = listHTML;
            }
            
            // Tampilkan preview file
            showPreview(fileId) {
                const fileData = this.currentUser.files.find(f => f.id === fileId);
                if (!fileData) return;
                
                this.currentPreviewFile = fileData;
                
                // Tampilkan modal
                const modal = document.getElementById('preview-modal');
                modal.style.display = 'flex';
                
                // Set judul
                document.getElementById('preview-title').textContent = `Preview: ${fileData.name}`;
                
                // Tampilkan loading
                document.getElementById('preview-content').innerHTML = `
                    <div class="py-8">
                        <div class="w-10 h-10 border-2 border-gray-300 border-t-blue-500 rounded-full spinner mx-auto mb-3"></div>
                        <p class="text-gray-600">Membuat preview...</p>
                    </div>
                `;
                
                // Generate preview
                setTimeout(() => {
                    const previewHTML = FileManager.generatePreview(fileData.fileObject, fileData);
                    document.getElementById('preview-content').innerHTML = previewHTML;
                }, 500);
            }
            
            // Tampilkan modal berbagi
            showShareModal(fileId) {
                const fileData = this.currentUser.files.find(f => f.id === fileId);
                if (!fileData) return;
                
                this.currentShareFile = fileData;
                
                // Tampilkan modal
                const modal = document.getElementById('share-modal');
                modal.style.display = 'flex';
                
                // Set data file
                document.getElementById('share-filename').textContent = fileData.name;
                
                // Generate link berbagi
                const shareLink = `${window.location.origin}/share/${fileData.id}`;
                document.getElementById('share-link').value = shareLink;
            }
            
            // Download file (simulasi)
            downloadFile(fileId) {
                const file = this.currentUser.files.find(f => f.id === fileId);
                if (file) {
                    Toast.show(`Mengunduh ${file.name}...`, 'info');
                    // Dalam implementasi nyata, ini akan mengunduh file dari server
                    
                    // Simulasi download
                    setTimeout(() => {
                        Toast.show(`${file.name} berhasil diunduh`, 'success');
                    }, 1000);
                }
            }
            
            // Delete file
            deleteFile(fileId) {
                if (!confirm('Apakah Anda yakin ingin menghapus file ini?')) return;
                
                const userKey = `${this.currentUser.username}_${this.currentUser.ip}`;
                const fileIndex = this.users[userKey].files.findIndex(f => f.id === fileId);
                
                if (fileIndex !== -1) {
                    const file = this.users[userKey].files[fileIndex];
                    this.users[userKey].storageUsed -= file.size;
                    this.users[userKey].files.splice(fileIndex, 1);
                    this.currentUser = this.users[userKey];
                    
                    this.saveUsers();
                    localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(this.currentUser));
                    
                    Toast.show(`File berhasil dihapus`, 'success');
                    
                    // Update tampilan
                    this.updateStorageInfo();
                    this.updateFileStats();
                    this.displayFiles();
                }
            }
            
            // Setup event listeners
            setupEventListeners() {
                // Tombol login/daftar
                document.getElementById('login-btn').addEventListener('click', () => {
                    this.handleLogin();
                });
                
                // Enter pada input username
                document.getElementById('username').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.handleLogin();
                    }
                });
                
                // Tombol logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    this.logout();
                });
                
                // Toggle user menu
                document.getElementById('user-menu-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const menu = document.getElementById('user-menu');
                    menu.classList.toggle('hidden');
                });
                
                // Tutup user menu saat klik di luar
                document.addEventListener('click', () => {
                    document.getElementById('user-menu').classList.add('hidden');
                });
                
                // Toggle view (grid/list)
                document.getElementById('view-grid').addEventListener('click', () => {
                    this.switchView('grid');
                });
                
                document.getElementById('view-list').addEventListener('click', () => {
                    this.switchView('list');
                });
                
                // Upload file
                const fileInput = document.getElementById('file-input');
                const browseBtn = document.getElementById('browse-btn');
                const dropArea = document.getElementById('drop-area');
                
                browseBtn.addEventListener('click', () => {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });
                
                // Drag and drop
                dropArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropArea.classList.add('border-blue-500', 'bg-blue-50');
                });
                
                dropArea.addEventListener('dragleave', () => {
                    dropArea.classList.remove('border-blue-500', 'bg-blue-50');
                });
                
                dropArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropArea.classList.remove('border-blue-500', 'bg-blue-50');
                    
                    if (e.dataTransfer.files.length) {
                        this.handleFiles(e.dataTransfer.files);
                    }
                });
                
                // Modal preview
                document.getElementById('close-preview').addEventListener('click', () => {
                    document.getElementById('preview-modal').style.display = 'none';
                });
                
                document.getElementById('preview-download').addEventListener('click', () => {
                    if (this.currentPreviewFile) {
                        this.downloadFile(this.currentPreviewFile.id);
                    }
                });
                
                document.getElementById('preview-share').addEventListener('click', () => {
                    if (this.currentPreviewFile) {
                        document.getElementById('preview-modal').style.display = 'none';
                        setTimeout(() => {
                            this.showShareModal(this.currentPreviewFile.id);
                        }, 300);
                    }
                });
                
                // Modal share
                document.getElementById('close-share').addEventListener('click', () => {
                    document.getElementById('share-modal').style.display = 'none';
                });
                
                document.getElementById('copy-link').addEventListener('click', () => {
                    const linkInput = document.getElementById('share-link');
                    linkInput.select();
                    document.execCommand('copy');
                    Toast.show('Link berhasil disalin ke clipboard', 'success');
                });
                
                // Tombol share ke sosial media
                document.querySelectorAll('.share-social').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const platform = e.target.closest('button').querySelector('i').className;
                        Toast.show(`Membagikan ke ${platform.includes('facebook') ? 'Facebook' : platform.includes('twitter') ? 'Twitter' : platform.includes('whatsapp') ? 'WhatsApp' : 'Email'}`, 'info');
                    });
                });
                
                // Tutup modal saat klik di luar
                window.addEventListener('click', (e) => {
                    const previewModal = document.getElementById('preview-modal');
                    const shareModal = document.getElementById('share-modal');
                    
                    if (e.target === previewModal) {
                        previewModal.style.display = 'none';
                    }
                    
                    if (e.target === shareModal) {
                        shareModal.style.display = 'none';
                    }
                });
            }
            
            // Ganti tampilan grid/list
            switchView(view) {
                this.currentView = view;
                
                if (view === 'grid') {
                    document.getElementById('files-grid-view').classList.remove('hidden');
                    document.getElementById('files-list-view').classList.add('hidden');
                    document.getElementById('view-grid').classList.add('bg-blue-100', 'text-blue-600');
                    document.getElementById('view-grid').classList.remove('bg-gray-100', 'text-gray-700');
                    document.getElementById('view-list').classList.remove('bg-blue-100', 'text-blue-600');
                    document.getElementById('view-list').classList.add('bg-gray-100', 'text-gray-700');
                } else {
                    document.getElementById('files-grid-view').classList.add('hidden');
                    document.getElementById('files-list-view').classList.remove('hidden');
                    document.getElementById('view-list').classList.add('bg-blue-100', 'text-blue-600');
                    document.getElementById('view-list').classList.remove('bg-gray-100', 'text-gray-700');
                    document.getElementById('view-grid').classList.remove('bg-blue-100', 'text-blue-600');
                    document.getElementById('view-grid').classList.add('bg-gray-100', 'text-gray-700');
                }
            }
            
            // Handle login
            handleLogin() {
                const username = document.getElementById('username').value.trim();
                const loginBtn = document.getElementById('login-btn');
                const loginText = document.getElementById('login-text');
                const loginSpinner = document.getElementById('login-spinner');
                
                // Tampilkan loading
                loginText.classList.add('hidden');
                loginSpinner.classList.remove('hidden');
                loginBtn.disabled = true;
                
                // Simulasi proses login
                setTimeout(() => {
                    if (this.loginOrRegister(username, this.userIP)) {
                        this.showDashboard();
                    }
                    
                    // Sembunyikan loading
                    loginText.classList.remove('hidden');
                    loginSpinner.classList.add('hidden');
                    loginBtn.disabled = false;
                }, 800);
            }
            
            // Handle file upload
            handleFiles(files) {
                if (!this.currentUser) {
                    Toast.show('Silakan login terlebih dahulu', 'error');
                    return;
                }
                
                const fileList = document.getElementById('file-list');
                fileList.innerHTML = '';
                
                // Tampilkan file yang dipilih
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const fileItem = document.createElement('div');
                    fileItem.className = 'flex items-center justify-between bg-gray-50 p-2 rounded text-xs';
                    fileItem.id = `file-${i}`;
                    
                    fileItem.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas ${FileManager.getFileIcon(file.name)} mr-2 text-blue-500"></i>
                            <div class="truncate max-w-xs">
                                <p class="font-medium">${file.name}</p>
                                <p class="text-gray-500">${FileManager.formatFileSize(file.size)}</p>
                            </div>
                        </div>
                        <div class="upload-status">
                            <div class="w-4 h-4 border-2 border-gray-300 border-t-blue-500 rounded-full spinner"></div>
                        </div>
                    `;
                    
                    fileList.appendChild(fileItem);
                }
                
                // Simulasi upload
                setTimeout(() => {
                    // Reset file list
                    fileList.innerHTML = '<p class="text-green-600 font-medium text-xs"><i class="fas fa-check-circle mr-1"></i>Semua file berhasil diunggah!</p>';
                    
                    // Tambahkan file ke sistem
                    let successCount = 0;
                    for (let i = 0; i < files.length; i++) {
                        if (this.addFile(files[i])) {
                            successCount++;
                        }
                    }
                    
                    if (successCount > 0) {
                        // Update tampilan
                        this.updateStorageInfo();
                        this.updateFileStats();
                        this.displayFiles();
                    }
                    
                    // Reset input file
                    document.getElementById('file-input').value = '';
                    
                    // Hapus pesan sukses setelah 3 detik
                    setTimeout(() => {
                        fileList.innerHTML = '';
                    }, 3000);
                }, 1500);
            }
            
            // Setup event delegation untuk tombol aksi file
            setupFileActionListeners() {
                // Event delegation untuk tombol aksi di grid view
                document.getElementById('files-grid-view').addEventListener('click', (e) => {
                    const target = e.target.closest('button');
                    if (!target) return;
                    
                    const fileId = target.dataset.fileId;
                    if (!fileId) return;
                    
                    if (target.classList.contains('preview-btn')) {
                        this.showPreview(fileId);
                    } else if (target.classList.contains('download-btn')) {
                        this.downloadFile(fileId);
                    } else if (target.classList.contains('share-btn')) {
                        this.showShareModal(fileId);
                    } else if (target.classList.contains('delete-btn')) {
                        this.deleteFile(fileId);
                    }
                });
                
                // Event delegation untuk tombol aksi di list view
                document.getElementById('recent-files').addEventListener('click', (e) => {
                    const target = e.target.closest('button');
                    if (!target) return;
                    
                    const fileId = target.dataset.fileId;
                    if (!fileId) return;
                    
                    if (target.classList.contains('preview-btn')) {
                        this.showPreview(fileId);
                    } else if (target.classList.contains('download-btn')) {
                        this.downloadFile(fileId);
                    } else if (target.classList.contains('share-btn')) {
                        this.showShareModal(fileId);
                    } else if (target.classList.contains('delete-btn')) {
                        this.deleteFile(fileId);
                    }
                });
            }
        }
        
        // ============================
        // INISIALISASI APLIKASI
        // ============================
        document.addEventListener('DOMContentLoaded', () => {
            // Inisialisasi aplikasi
            window.cloudBoxApp = new CloudBoxApp();
            
            // Setup event listeners untuk file actions setelah DOM siap
            setTimeout(() => {
                if (window.cloudBoxApp && window.cloudBoxApp.setupFileActionListeners) {
                    window.cloudBoxApp.setupFileActionListeners();
                }
            }, 1000);
            
            // Tambahkan animasi pada elemen saat scroll
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                    }
                });
            }, observerOptions);
            
            // Amati semua file card
            setTimeout(() => {
                document.querySelectorAll('.file-card').forEach(card => {
                    observer.observe(card);
                });
            }, 500);
        });
    </script>
</body>
</html>
